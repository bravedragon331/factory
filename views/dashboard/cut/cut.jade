extends ./layout
block page-body
  .panel.panel-default.order-panel
    .panel-body
      h4 #{__('Order')} #{__('List')}
      table.table.table-bordered.table-striped.table-hover.js-basic-example.order-table.dataTable
        thead
          tr
            th #{__('Date')}
            th #{__('Handler')}
            th #{__('File')}#
            th #{__('Buyer')}
            th #{__('Style')}
            th #{__('Product')}
            th #{__('Season')}
            th #{__('Quantity')}
        tbody
  - for(var ppp = 0; ppp < role.length; ppp++){
    - if(role[ppp].page == 4 && role[ppp].w == 1){
        .panel.panel-default.add-cut-panel(style='display:none;')
          .panel-heading
            | #{__('Add')} #{__('Cut')}
          .panel-body
            form.add-form
              input(type="hidden").order-id
              .form-group.clearfix.col-md-2
                label.display-block #{__('Style')}
                select.select-bar.new-style(style='width: 100%;')
                  option(value='-1') Not Selected            
              .form-group.clearfix.col-md-2
                label.display-block #{__("COLOR")}
                select.select-bar.new-color.select-fabric(style='width: 100%;')
                  option(value='-1') Not Selected            
              .form-group.clearfix.col-md-2
                label.display-block #{__("COLOR CODE")}
                select.select-bar.new-colorcode.select-fabric(style='width: 100%;')
                  option(value='-1') Not Selected
              .form-group.clearfix.col-md-2
                label.display-block #{__('LOTE')}
                input.form-control.new-lote(type='text', placeholder='LOTE')
              .form-group.clearfix.col-md-2
                label.display-block #{__('YDS')}
                input.form-control.new-yds(type='text', placeholder='YDS')
              .form-group.clearfix.col-md-2
                label.display-block #{__('CUT')} #{__('DATE')}
                input.form-control.new-cutdate(type='text', placeholder='Please choose a date...', data-format='YYYY-MM-DD')
              .form-group.clearfix.col-md-2
                label.display-block #{__('CUT')} #{__('ORD')}#
                input.form-control.new-cutord(type='text', placeholder='CUT ORD#', required)
              .form-group.clearfix.col-md-2.size-1
                label.display-block #{__('Size')}1
                input.form-control.new-size-1(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-2
                label.display-block #{__('Size')}2
                input.form-control.new-size-2(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-3
                label.display-block #{__('Size')}3
                input.form-control.new-size-3(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-4
                label.display-block #{__('Size')}4
                input.form-control.new-size-4(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-5
                label.display-block #{__('Size')}5
                input.form-control.new-size-5(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-6
                label.display-block #{__('Size')}6
                input.form-control.new-size-6(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-7
                label.display-block #{__('Size')}7
                input.form-control.new-size-7(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-8
                label.display-block #{__('Size')}8
                input.form-control.new-size-8(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-9
                label.display-block #{__('Size')}9
                input.form-control.new-size-9(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-10
                label.display-block #{__('Size')}10
                input.form-control.new-size-10(type='text', placeholder='')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Envoi')}#
                input.form-control.new-envio(type='text', placeholder='Envio#')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Lienzos')}
                input.form-control.new-lienzos(type='text', placeholder='Lienzos#')
              //- .form-group.clearfix.col-md-2
              //-   label.display-block Yds Etique.
              //-   input.form-control.new-ydsetique(type='text', placeholder='Yds Etique')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Malo')}
                input.form-control.new-malo(type='text', placeholder='Malo')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Faltante')}
                input.form-control.new-faltante(type='text', placeholder='Faltante')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Yds')} #{__('Used')}
                input.form-control.new-ydsused(type='text', placeholder='Yds Used')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Bies')}
                input.form-control.new-bies(type='text', placeholder='Bies')
              //- .form-group.clearfix.col-md-2
              //-   label.display-block Total
              //-   input.form-control.new-total(type='text', placeholder='Total')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Qty')} #{__('Rollo')}
                input.form-control.new-qtyrollo(type='text', placeholder='Qty Rollo')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Tendedor')}
                input.form-control.new-tendedor(type='text', placeholder='Tendedor')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Remark')}
                input.form-control.new-remark(type='text', placeholder='Remark')
              .form-group.col-md-12
                button.btn.btn-sm.btn-success.pull-right(type='submit') #{__('Add')} #{__('Cut')}
        .panel.panel-default.update-cut-panel(style='display:none;')
          .panel-heading
            | #{__('Update')} #{__('Cut')}
          .panel-body
            form.update-form
              input(type="hidden").order-id
              input(type='hidden').old-id
              .form-group.clearfix.col-md-2
                label.display-block #{__('STYLE')}
                select.select-bar.update-style(style='width: 100%;')
                  option(value='-1') Not Selected            
              .form-group.clearfix.col-md-2
                label.display-block #{__("COLOR")}
                select.select-bar.update-color.select-fabric(style='width: 100%;')
                  option(value='-1') Not Selected            
              .form-group.clearfix.col-md-2
                label.display-block #{__("COLOR CODE")}
                select.select-bar.update-colorcode.select-fabric(style='width: 100%;')
                  option(value='-1') Not Selected
              .form-group.clearfix.col-md-2
                label.display-block #{__('LOTE')}
                input.form-control.update-lote(type='text', placeholder='LOTE')
              .form-group.clearfix.col-md-2
                label.display-block #{__('YDS')}
                input.form-control.update-yds(type='text', placeholder='YDS')
              .form-group.clearfix.col-md-2
                label.display-block #{__('CUT')} #{__('DATE')}
                input.form-control.update-cutdate(type='text', placeholder='Please choose a date...', data-format='YYYY-MM-DD')
              .form-group.clearfix.col-md-2
                label.display-block #{__('CUT')} #{__('ORD')}#
                input.form-control.update-cutord(type='text', placeholder='CUT ORD#', required, readonly)
              .form-group.clearfix.col-md-2.size-1
                label.display-block #{__('Size')}1
                input.form-control.update-size-1(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-2
                label.display-block #{__('Size')}2
                input.form-control.update-size-2(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-3
                label.display-block #{__('Size')}3
                input.form-control.update-size-3(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-4
                label.display-block #{__('Size')}4
                input.form-control.update-size-4(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-5
                label.display-block #{__('Size')}5
                input.form-control.update-size-5(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-6
                label.display-block #{__('Size')}6
                input.form-control.update-size-6(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-7
                label.display-block #{__('Size')}7
                input.form-control.update-size-7(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-8
                label.display-block #{__('Size')}8
                input.form-control.update-size-8(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-9
                label.display-block #{__('Size')}9
                input.form-control.update-size-9(type='text', placeholder='')
              .form-group.clearfix.col-md-2.size-10
                label.display-block #{__('Size')}10
                input.form-control.update-size-10(type='text', placeholder='')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Envio')}#
                input.form-control.update-envio(type='text', placeholder='Envio#')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Lienzos')}
                input.form-control.update-lienzos(type='text', placeholder='Lienzos#')
              //- .form-group.clearfix.col-md-2
              //-   label.display-block Yds Etique.
              //-   input.form-control.update-ydsetique(type='text', placeholder='Yds Etique')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Malo')}
                input.form-control.update-malo(type='text', placeholder='Malo')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Faltante')}
                input.form-control.update-faltante(type='text', placeholder='Faltante')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Yds')} #{__('Used')}
                input.form-control.update-ydsused(type='text', placeholder='Yds Used')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Bies')}
                input.form-control.update-bies(type='text', placeholder='Bies')
              //- .form-group.clearfix.col-md-2
              //-   label.display-block Total
              //-   input.form-control.update-total(type='text', placeholder='Total')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Qty')} #{__('Rollo')}
                input.form-control.update-qtyrollo(type='text', placeholder='Qty Rollo')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Tendedor')}
                input.form-control.update-tendedor(type='text', placeholder='Tendedor')
              .form-group.clearfix.col-md-2
                label.display-block #{__('Remark')}
                input.form-control.update-remark(type='text', placeholder='Remark')
              .form-group.col-md-12
                button.btn.btn-sm.btn-success.pull-right(type='submit') #{__('Update')} #{__('Cut')}
                - if(role[ppp].page == 4 && role[ppp].d == 1){
                  .btn.btn-sm.btn-success.pull-right.remove(style='margin-right: 20px;') #{__("Remove Cut")}
                - }
    - }
  - }

  ul.nav.nav-tabs.bg-default
  .tab-content
    #tab_.tab-pane.fade.in.active(role='tabpanel')
      .panel.panel-default.cut-list-panel(style='display:none;')
        .panel-heading
          | #{__('CUT')} #{__('List')}
        .panel-body
          .align-justify
            - for(var ppp = 0; ppp < role.length; ppp++){
              - if(role[ppp].page == 4 && role[ppp].w == 1){
                  .p-b-10
                    button.btn.btn-sm.btn-success.add-cut
                      i.fa.fa-plus.m-r-5
                      | #{__('Add')} #{__('New')} #{__('Cut')}
              - }
            - }
            table#mainTable.table.table-bordered.table-striped.detailview
              thead.bg-blue-grey
                tr
                  th(rowspan='2') #{__('STYLE')}#                  
                  th(rowspan='2', width='60')
                    | #{__('COLOR')}
                    br
                    | #{__('CODE')}#
                  th(rowspan='2') #{__('COLOR')}
                  th(rowspan='2') #{__('LOTE')}
                  th(rowspan='2') #{__('YDS')}
                  th(rowspan='2', width='60') #{__('CUT')} #{__('DATE')}
                  th(rowspan='2', width='60') #{__('CUT')} #{__('ORD')}#
                  th.align-center.size-header-span #{__('SIZE')}
                  th(rowspan='2') #{__('Qty')}
                  th(rowspan='2') #{__('Envio')}#
                  th(rowspan='2') #{__('Lienzos')}
                  //- th(rowspan='2') Yds Etique.
                  th(rowspan='2') #{__('Malo')}
                  th(rowspan='2') #{__('Faltante')}
                  th(rowspan='2') #{__('Yds')} #{__('Used')}
                  th(rowspan='2') #{__('Bies')}
                  //- th(rowspan='2') Total
                  th(rowspan='2') #{__('Qty')} #{__('Rollo')}
                  th(rowspan='2') #{__('Tendedor')}
                  th(rowspan='2') #{__('Remark')}
                tr.sizeheader
              tbody
block script2
  script.
    var fabrics = (!{JSON.stringify(fabric)}), tasks, orderfabrics, orderftypes, fabric, allcustomers = (!{JSON.stringify(allcustomers)}), buyer, name, cutdata;

    function init(){          
      $('.new-shipdate').datetimepicker({
        format: 'YYYY-MM-DD',
        showClear: true
      });
      $('.new-cutdate').datetimepicker({
        format: 'YYYY-MM-DD',
        showClear: true
      });
      $('.new-style').select2();
      $('.new-color').select2();      
      $('.new-colorcode').select2();
      var b1 = true;
      var b2 = true;
      $('.new-color').on('change', function(){
        if(b2){
          b1 = false;
          $('.new-colorcode').val($(this).val()).trigger('change');        
        }
        b2 = true;
      })
      $('.new-colorcode').on('change', function(){
        if(b1){
          b2 = false;
          $('.new-color').val($(this).val()).trigger('change');
        }
        b1 = true;
      })

      $('.update-shipdate').datetimepicker({
        format: 'YYYY-MM-DD',
        showClear: true
      });
      $('.update-cutdate').datetimepicker({
        format: 'YYYY-MM-DD',
        showClear: true
      });
      $('.update-style').select2();
      $('.update-color').select2();
      $('.update-colorcode').select2();
      var b1 = true;
      var b2 = true;
      $('.update-color').on('change', function(){
        if(b2){
          b1 = false;
          $('.update-colorcode').val($(this).val()).trigger('change');        
        }
        b2 = true;
      })
      $('.update-colorcode').on('change', function(){
        if(b1){
          b2 = false;
          $('.update-color').val($(this).val()).trigger('change');
        }
        b1 = true;
      })

      $('.add-cut-panel').on('click', 'a.panel-close', function () {
        $(this).parents('.add-cut-panel').fadeOut();
      });
      $('.update-cut-panel').on('click', 'a.panel-close', function () {
        $(this).parents('.update-cut-panel').fadeOut();
      });
      $('.add-cut').on('click', function(){
        $('.add-cut-panel').fadeIn();
        $('.update-cut-panel').fadeOut();
      })
    }

    init();

  
    $('.search-form').submit(function(e){
      e.preventDefault();
      var startdate = $('.in-date').val().split('-')[0];
      var enddate = $('.in-date').val().split('-')[1];

      $.ajax({
        url: '/dashboard/cut/search',
        type: 'POST',
        data: {
          buyer: $('.buyer').val(),
          startdate: startdate,
          enddate: enddate,
          fabric_type: $('.fabric-type').val(),
          fabric: $('.fabric').val(),
          color: $('.color').val(),
          po: $('.po').val(),
          style: $('.style').val()
        },
        success: function(result){
          if(result.isSuccess){
            //console.log(result.list);
            fillOrderTable(result.list);
          }else{
            alert('Cannot search.');
          }
        }
      })
    })

    var fillOrderTable = function(list){
      $('.order-panel').show();
      var tableData = [];
      for(let i = 0; i < list.length; i++){
        tableData.push([
          list[i].date.split('T')[0], list[i].handlername, list[i].name, list[i].buyername, list[i].style, list[i].product, list[i].season, list[i].quantity
        ])
      }
      $('.order-table').dataTable().fnClearTable();
      if(tableData.length > 0){
        $('.order-table').dataTable().fnAddData(tableData);
        $('.order-table').dataTable().fnDraw();
      }
      refreshEvent();
    }

    var orderdata;

    var refreshEvent = function(){
      $('.order-table tbody tr').off();
      $('.order-table tbody tr').on('click', function(){
        ordername = $($(this).find('td')[2]).html();        
        buyer =  $($(this).find('td')[3]).html();                
        style = $($(this).find('td')[4]).html();
        $.ajax({
          url: '/dashboard/common/order_fabric',
          type: 'POST',
          data: {
            name: ordername,
            buyer: buyer
          },
          success: function(data){
            if(data.isSuccess){
              orderfabrics = data.fabrics.fabrics;            
              //Tab Nav Menu
              var ht = '';
              for(var i = 0; i < orderfabrics.length; i++){
                for(var j = 0; j < fabrics.length; j++){
                  if(orderfabrics[i].id == fabrics[j].id){
                    ht += '<li role="presentation">';
                    ht += '<a href = "#tab_'+'", data-toggle="tab", data-fabric="'+orderfabrics[i].id+'", data-buyer="'+buyer+'" class="tab_'+i+'">'+fabrics[j].name+'</a>';
                    ht += '</li>';
                  }
                }
              }
              $('.nav-tabs').html(ht);
              refreshTabEvent();
            }else{
              alert('Cannot load Fabric list.');
            }
          }
        });

        $.ajax({
          url: '/dashboard/cut/order_detail',
          type: 'POST',
          data: {
            name: ordername,
            buyer: buyer
          },
          success: function(data){
            if(data.isSuccess){
              console.log(data);
              orderdata = data;
              var ht = '', len = 0;
              for(var i = 1; i < 11; i++){
                if(data.sizegroup['size'+i] != -1){
                  for(var j = 0; j < data.sizes.length; j++){
                    if(data.sizes[j].id == data.sizegroup['size'+i]){
                      len++;
                      ht += `<th width = "60">`+data.sizes[j].name+`</th>`;
                      $('.size-'+i+'>label').html(data.sizes[j].name);
                    }
                  }
                  $('.size-'+i).show();                  
                }else{
                  $('.size-'+i).hide();
                }
              }
              $('.sizeheader').html(ht);
              $('.size-header-span').attr('colspan',len);

              $(".new-color").select2("destroy");
              $('.new-color').html("");
              $('.new-color').append(
                  '<option value="-1">Not Selected</option>'
              );
              var colorname = [];
              for(var index = 0; index < data.orderdetails.length; index++){
                if(!colorname.includes(data.orderdetails[index].colorname)){
                  
                  $('.new-color').append(
                    '<option value="' + data.orderdetails[index].color + '">' + data.orderdetails[index].colorname + '</option>'
                  );
                  colorname.push(data.orderdetails[index].colorname);
                }
              }
              $(".new-color").select2();
              $(".new-colorcode").select2("destroy");
              $('.new-colorcode').html("");
              $('.new-colorcode').append(
                  '<option value="-1">Not Selected</option>'
              );
              var colorcode = [];
              for(var index = 0; index < data.orderdetails.length; index++) {
                if(!colorcode.includes(data.orderdetails[index].color)){
                  $('.new-colorcode').append(
                    '<option value="' + data.orderdetails[index].color + '">' + data.orderdetails[index].color + '</option>'
                  );
                  colorcode.push(data.orderdetails[index].color);
                }
              };
              $(".new-colorcode").select2();
              $(".new-style").select2("destroy");
              $('.new-style').html("");
              $('.new-style').append(
                  '<option value="-1">Not Selected</option>'
              );
              var stylename = [];
              for(var index = 0; index < data.orderdetails.length; index++){
                if(!stylename.includes(data.orderdetails[index].style)){
                  
                  $('.new-style').append(
                    '<option value="' + data.orderdetails[index].style + '">' + data.orderdetails[index].style + '</option>'
                  );
                  stylename.push(data.orderdetails[index].style);
                }
              }
              $(".new-style").select2();
              $(".update-color").select2("destroy");
              $('.update-color').html("");
              $('.update-color').append(
                  '<option value="-1">Not Selected</option>'
              );
              var colorname = [];
              for(var index = 0; index < data.orderdetails.length; index++){
                if(!colorname.includes(data.orderdetails[index].colorname)){
                  
                  $('.update-color').append(
                    '<option value="' + data.orderdetails[index].color + '">' + data.orderdetails[index].colorname + '</option>'
                  );
                  colorname.push(data.orderdetails[index].colorname);
                }
              }
              $(".update-color").select2();
              $(".update-colorcode").select2("destroy");
              $('.update-colorcode').html("");
              $('.update-colorcode').append(
                  '<option value="-1">Not Selected</option>'
              );
              var colorcode = [];
              for(var index = 0; index < data.orderdetails.length; index++) {
                if(!colorcode.includes(data.orderdetails[index].color)){
                  $('.update-colorcode').append(
                    '<option value="' + data.orderdetails[index].color + '">' + data.orderdetails[index].color + '</option>'
                  );
                  colorcode.push(data.orderdetails[index].color);
                }
              };
              $(".update-colorcode").select2();
              $(".update-style").select2("destroy");
              $('.update-style').html("");
              $('.update-style').append(
                  '<option value="-1">Not Selected</option>'
              );
              var stylename = [];
              for(var index = 0; index < data.orderdetails.length; index++){
                if(!stylename.includes(data.orderdetails[index].style)){
                  
                  $('.update-style').append(
                    '<option value="' + data.orderdetails[index].style + '">' + data.orderdetails[index].style + '</option>'
                  );
                  stylename.push(data.orderdetails[index].style);
                }
              }
              $(".update-style").select2();
              
              $('.tab_0').click();
            }else{
              alert('Cannot load order data.');
            }
          }
        });
      });
    }

    var refreshTabEvent = function(){
      $('.cut-list-panel').hide();      
      $('a[data-toggle="tab"]').off();
      $('a[data-toggle="tab"]').on('click', function(){
        fabric = $(this).data('fabric');
        loadCutData();        
      });
    }

    var loadCutData = function(){
      $('.cut-list-panel').show();
      $('.update-cut-panel').fadeOut();
      $('.add-cut-panel').fadeOut();
      $.ajax({
        url: '/dashboard/cut/list',
        type: 'POST',
        data: {
          orderid: orderdata.order.id,
          fabric: fabric
        },
        success: function(result){
          if(result.isSuccess){
            cutdata = result.list;
            var ht = '';            
            for(var i = 0; i < result.list.length; i++){
              ht += '<tr>';              
              ht += '<td class="StringData">'+ result.list[i].style + '</td>';              
              ht += '<td class="StringData">'+ result.list[i].color + '</td>';
              ht += '<td class="StringData">'+ result.list[i].colorname + '</td>';
              ht += '<td class="StringData">'+ result.list[i].lote + '</td>';
              ht += '<td class="StringData">'+ result.list[i].yds + '</td>';
              ht += '<td class="StringData">'+ result.list[i].cutdate + '</td>';
              ht += '<td class="StringData">'+ result.list[i].cutord + '</td>';
              var sum = 0;
              for(var j = 1; j < 11; j++){
                if(orderdata.sizegroup['size'+j] != -1){
                  sum += Number(result.list[i]['size'+j]);
                  ht += '<td class="NumericData">'+ result.list[i]['size'+j] + '</td>';
                }
              }
              ht += '<td>'+sum+'</td>';
              ht += '<td class="NumericData">'+ result.list[i].envio + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].lienzos + '</td>';
              //ht += '<td class="NumericData">'+ result.list[i].ydsetique + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].malo + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].faltante + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].ydsused + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].bies + '</td>';
              //- ht += '<td class="NumericData">'+ result.list[i].total + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].qtyrollo + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].tendedor + '</td>';
              ht += '<td class="NumericData">'+ result.list[i].remark + '</td>';

              ht + '</tr>'
            }
            $('.cut-list-panel tbody').html(ht);

            refreshTableEvent();

          }else{
            alert('Cannot load Cut data');        
          }
        }
      })
    }

    var refreshTableEvent = function(){
      $('.cut-list-panel tbody tr').on('click', function(){
        $('.update-cut-panel').fadeIn();
        $('.add-cut-panel').fadeOut();
                
        var colorcode = $($(this).find('td')[1]).html();
        var style = $($(this).find('td')[0]).html();
        var cutord = $($(this).find('td')[6]).html();
        console.log(cutdata);
        for(var i = 0; i < cutdata.length; i++){
          if(cutdata[i].style == style && cutord == cutdata[i].cutord && colorcode == cutdata[i].color){
            fillUpdateForm(cutdata[i]);
          }
        }
      })
    }

    var fillUpdateForm = function(data){
      $('.update-style').val(data.style).trigger('change');
      $('.old-id').val(data.id);
      setTimeout(function(){
        $('.update-color').val(data.color).trigger('change');
      }, 500);
      $('.update-lote').val(data.lote);
      $('.update-yds').val(data.yds);
      $('.update-cutdate').val(data.cutdate);
      $('.update-cutord').val(data.cutord);
      $('.update-size-1').val(data.size1);
      $('.update-size-2').val(data.size2);
      $('.update-size-3').val(data.size3);
      $('.update-size-4').val(data.size4);
      $('.update-size-5').val(data.size5);
      $('.update-size-6').val(data.size6);
      $('.update-size-7').val(data.size7);
      $('.update-size-8').val(data.size8);
      $('.update-size-9').val(data.size9);
      $('.update-size-10').val(data.size10);
      $('.update-envio').val(data.envio);
      $('.update-lienzos').val(data.lienzos);
      //$('.update-ydsetique').val(data.ydsetique);
      $('.update-malo').val(data.malo);
      $('.update-faltante').val(data.faltate);
      $('.update-ydsused').val(data.ydsused);
      $('.update-bies').val(data.bies);
      //- $('.update-total').val(data.total);
      $('.update-qtyrollo').val(data.qtyrollo);
      $('.update-tendedor').val(data.tendedor);
      $('.update-remark').val(data.remark);
    }

    $('.add-form').submit(function(e){
      e.preventDefault();      
      $.ajax({
        url: '/dashboard/cut/add',
        type: 'POST',
        data: {
          order: orderdata.order.id,
          fabric: fabric,
          style: $('.new-style').val(),
          color: $('.new-color').val(),
          colorname: $('.new-color').select2('data')[0].text,
          lote: $('.new-lote').val(),
          yds: $('.new-yds').val(),
          cutdate: $('.new-cutdate').val(),
          cutord: $('.new-cutord').val(),
          size1: $('.new-size-1').val(),
          size2: $('.new-size-2').val(),
          size3: $('.new-size-3').val(),
          size4: $('.new-size-4').val(),
          size5: $('.new-size-5').val(),
          size6: $('.new-size-6').val(),
          size7: $('.new-size-7').val(),
          size8: $('.new-size-8').val(),
          size9: $('.new-size-9').val(),
          size10: $('.new-size-10').val(),
          envio: $('.new-envio').val(),
          lienzos: $('.new-lienzos').val(),
          //ydsetique: $('.new-ydsetique').val(),
          malo: $('.new-malo').val(),
          faltante: $('.new-faltante').val(),
          ydsused: $('.new-ydsused').val(),
          bies: $('.new-bies').val(),
          //- total: $('.new-total').val(),
          qtyrollo: $('.new-qtyrollo').val(),
          tendedor: $('.new-tendedor').val(),
          remark: $('.new-remark').val()
        },
        success: function(data){
          if(data.isSuccess){
            loadCutData();
            reset();
          }else{
            alert('There is already same Cut ORD#. Please check detail.');
          }
        }
      })
    })

    $('.update-form').submit(function(e){
      e.preventDefault();      
      $.ajax({
        url: '/dashboard/cut/update',
        type: 'POST',
        data: {
          oldid: $('.old-id').val(),
          order: orderdata.order.id,          
          fabric: fabric,
          style: $('.update-style').val(),
          color: $('.update-color').val(),
          colorname: $('.update-color').select2('data')[0].text,
          lote: $('.update-lote').val(),
          yds: $('.update-yds').val(),
          cutdate: $('.update-cutdate').val(),
          cutord: $('.update-cutord').val(),
          size1: $('.update-size-1').val(),
          size2: $('.update-size-2').val(),
          size3: $('.update-size-3').val(),
          size4: $('.update-size-4').val(),
          size5: $('.update-size-5').val(),
          size6: $('.update-size-6').val(),
          size7: $('.update-size-7').val(),
          size8: $('.update-size-8').val(),
          size9: $('.update-size-9').val(),
          size10: $('.update-size-10').val(),
          envio: $('.update-envio').val(),
          lienzos: $('.update-lienzos').val(),
          //ydsetique: $('.update-ydsetique').val(),
          malo: $('.update-malo').val(),
          faltante: $('.update-faltante').val(),
          ydsused: $('.update-ydsused').val(),
          bies: $('.update-bies').val(),
          //- total: $('.update-total').val(),
          qtyrollo: $('.update-qtyrollo').val(),
          tendedor: $('.update-tendedor').val(),
          remark: $('.update-remark').val()
        },
        success: function(data){
          if(data.isSuccess){
            loadCutData();
            reset();
          }else{
            alert('Cannot save Cut data.');
          }
        }
      })
    })

    $('.remove').on('click', function(){
      $.ajax({
        url: '/dashboard/cut/delete',
        type: 'POST',
        data: {
          oldid: $('.old-id').val()
        },
        success: function(result){
          if(result.isSuccess){
            loadCutData();
          }else{
            alert('Cannot Delete Cut data.');
          }
        }
      })
    })

    var reset = function(){
      $('.update-cut-panel').fadeOut();
      $('.new-lote').val('');
      $('.new-yds').val('');
      $('.new-cutdate').val('');
      $('.new-cutord').val('');
      $('.new-size-1').val('');
      $('.new-size-2').val('');
      $('.new-size-3').val('');
      $('.new-size-4').val('');
      $('.new-size-5').val('');
      $('.new-size-6').val('');
      $('.new-size-7').val('');
      $('.new-size-8').val('');
      $('.new-size-9').val('');
      $('.new-size-10').val('');
      $('.new-envio').val('');
      $('.new-lienzos').val('');
      //$('.new-ydsetique').val('');
      $('.new-malo').val('');
      $('.new-faltante').val('');
      $('.new-ydsused').val('');
      $('.new-bies').val('');
      //- $('.new-total').val('');
      $('.new-qtyrollo').val('');
      $('.new-tendedor').val('');
      $('.new-remark').val('');
    }

    $('.order-table').on( 'page.dt', function () {
      setTimeout(function(){
        refreshEvent();
      }, 500)
    });

    $('.order-table').on( 'search.dt', function () {
      setTimeout(function(){
        refreshEvent();
      }, 500)
    });